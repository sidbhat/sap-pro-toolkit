async function detectLanguage(){try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(e&&e.url&&isSFPage(e.url)){const t=new URL(e.url),n=t.searchParams.get("locale");if(n){return n.split("_")[0]}const o=t.pathname.match(/\/([a-z]{2}_[A-Z]{2})\//);if(o){return o[1].split("_")[0]}}}catch(e){}return navigator.language.split("-")[0]}function initI18n(){document.querySelectorAll("[data-i18n]").forEach(e=>{const t=e.getAttribute("data-i18n");e.textContent=chrome.i18n.getMessage(t)||e.textContent}),document.querySelectorAll("[data-i18n-title]").forEach(e=>{const t=e.getAttribute("data-i18n-title");e.title=chrome.i18n.getMessage(t)||e.title}),document.querySelectorAll("[data-i18n-placeholder]").forEach(e=>{const t=e.getAttribute("data-i18n-placeholder");e.placeholder=chrome.i18n.getMessage(t)||e.placeholder})}const ENV_COLORS={production:"#ef4444",preview:"#10b981",sales:"#f59e0b",sandbox:"#a855f7",unknown:"#6b7280"},ENV_EMOJIS={production:"ğŸ”´",preview:"ğŸŸ¢",sales:"ğŸŸ ",sandbox:"ğŸŸ£",unknown:"âš«"},ENV_LABELS={production:"PRODUCTION",preview:"PREVIEW",sales:"SALES",sandbox:"SANDBOX",unknown:"UNKNOWN"},COUNTRY_FLAGS={AE:"ğŸ‡¦ğŸ‡ª",SA:"ğŸ‡¸ğŸ‡¦",CN:"ğŸ‡¨ğŸ‡³",DE:"ğŸ‡©ğŸ‡ª",US:"ğŸ‡ºğŸ‡¸",CA:"ğŸ‡¨ğŸ‡¦",JP:"ğŸ‡¯ğŸ‡µ",SG:"ğŸ‡¸ğŸ‡¬",NL:"ğŸ‡³ğŸ‡±",BR:"ğŸ‡§ğŸ‡·",AU:"ğŸ‡¦ğŸ‡º",CH:"ğŸ‡¨ğŸ‡­",IN:"ğŸ‡®ğŸ‡³"};function renderSAPIcon(e,t="shortcut",n=16){if(void 0===window.SAPIconLibrary){return`<span style="font-size: ${n}px;">${{shortcut:"ğŸ—ºï¸",note:"ğŸ“",environment:"ğŸŒ"}[t]||"ğŸ“Œ"}</span>`}const o=window.SAPIconLibrary.getIconByValue(e,t);return window.SAPIconLibrary.renderIconSVG(o,n)}function suggestIconForContent(e,t,n,o="shortcut"){return void 0===window.SAPIconLibrary?"note"===o?"0":"8":window.SAPIconLibrary.suggestIcon(e,t,n,o)}function isSFPage(e){if(!e)return!1;return["hr.cloud.sap","sapsf.com","sapsf.cn","sapcloud.cn","successfactors.eu","sapsf.eu","successfactors.com"].some(t=>e.includes(t))}function detectEnvironmentFromURL(e){const t=new URL(e).hostname;return{environment:detectEnvironmentHeuristic(t),datacenter:"Unknown",hostname:t,country:"Unknown",platform:"Unknown",region:"Unknown",apiHostname:"Unknown",detectedVia:"heuristic"}}function detectEnvironmentHeuristic(e){if(e.includes("-preview")||e.includes("preview-")||e.includes("preview."))return"preview";const t=e.toLowerCase();return t.startsWith("demo.")||t.startsWith("sales.")||t.includes("-demo")||t.includes("-sales")?"sales":e.includes("sandbox")||e.includes("-test")||e.includes("test-")?"sandbox":"production"}function buildShortcutUrl(e,t){const n=e.url;return n.startsWith("http://")||n.startsWith("https://")?n:n.startsWith("/")?t&&t.hostname?`https://${t.hostname}${n}`:null:t&&t.hostname?`https://${t.hostname}/${n}`:n}function isAbsoluteUrl(e){return e&&(e.startsWith("http://")||e.startsWith("https://"))}const SOLUTION_PATTERNS={successfactors:["successfactors.com","sapsf.com","sapsf.cn","sapsf.eu","hr.cloud.sap","successfactors.eu","sapcloud.cn"],s4hana:["s4hana.ondemand.com","s4hana.cloud.sap","/sap/bc/ui5","/sap/bc/webdynpro","fiorilaunchpad","#Shell-home"],btp:["hana.ondemand.com","cfapps","build.cloud.sap","cockpit.btp"],ibp:["ibp.cloud.sap","ibplanning"]};function detectSolutionType(e,t){if(!e||!t)return null;if(SOLUTION_PATTERNS.successfactors.some(e=>t.includes(e)))return"successfactors";if(SOLUTION_PATTERNS.s4hana.some(n=>e.includes(n)||t.includes(n)))return"s4hana";if(SOLUTION_PATTERNS.ibp.some(n=>t.includes(n)||e.includes(n)))return"ibp";return SOLUTION_PATTERNS.btp.some(e=>t.includes(e))?"btp":null}function extractAllUrlParameters(e,t){if(!e)return{};try{const n=new URL(e),o={};n.searchParams.forEach((e,t)=>{o[t]=e});let s="";if(t&&t.companyId)s=t.companyId;else if(o.bplte_company)s=o.bplte_company;else if(o.company)s=o.company;else{const e=n.hostname.match(/^([^.]+)\./);if(e&&e[1]){const t=e[1];["www","api","auth","login"].includes(t.toLowerCase())||(s=t)}}return{hostname:n.hostname,protocol:n.protocol,pathname:n.pathname,params:o,company:s,proxy:o.proxy||"",locale:o.locale||"",queryString:n.search.substring(1)}}catch(e){return console.error("[SF Pro Toolkit] Failed to parse URL:",e),{}}}function buildQuickActionUrl(e,t,n){const o=extractAllUrlParameters(n);let s=e.path,r="";if(s.includes("#")){const[e,t]=s.split("#");s=e,r="#"+t}const[a,c]=s.split("?"),i=new URLSearchParams(o.queryString);if(c){new URLSearchParams(c).forEach((e,t)=>{e.includes("{{company}}")&&(e=e.replace("{{company}}",o.company)),e.includes("{{proxy}}")&&(e=e.replace("{{proxy}}",o.proxy)),e.includes("{{hostname}}")&&(e=e.replace("{{hostname}}",o.hostname)),i.set(t,e)})}return`https://${o.hostname}${a}?${i.toString()}${r}`}function setupEnhancedKeyboardShortcuts(e){document.addEventListener("keydown",t=>{if((t.metaKey||t.ctrlKey)&&"k"===t.key&&(t.preventDefault(),document.getElementById("globalSearch")?.focus()),(t.metaKey||t.ctrlKey)&&t.shiftKey&&"N"===t.key&&(t.preventDefault(),e.addShortcut&&e.addShortcut()),(t.metaKey||t.ctrlKey)&&"m"===t.key&&(t.preventDefault(),e.addNote&&e.addNote()),!t.target.matches("input, textarea, select")){const e=document.querySelectorAll('.env-row:not([style*="display: none"]), .shortcut-row:not([style*="display: none"]), .note-row:not([style*="display: none"])'),n=Array.from(e).findIndex(e=>e.classList.contains("keyboard-focus"));if("ArrowDown"===t.key)t.preventDefault(),navigateRows(e,n,1);else if("ArrowUp"===t.key)t.preventDefault(),navigateRows(e,n,-1);else if("Enter"===t.key&&n>=0){t.preventDefault();const o=e[n];if(o.classList.contains("env-row")){const e=o.querySelector(".switch-btn");e&&e.click()}else if(o.classList.contains("shortcut-row"))o.click();else if(o.classList.contains("note-row")){const e=o.querySelector(".copy-btn");e&&e.click()}}}if("Tab"!==t.key||t.target.matches("input, textarea, select")||document.querySelectorAll(".keyboard-focus").forEach(e=>{e.classList.remove("keyboard-focus")}),"Escape"===t.key){const t=document.querySelector(".modal.active");if(t)t.classList.remove("active");else{const t=document.getElementById("globalSearch");if(t&&t.value){t.value="";const n=document.getElementById("clearSearch");n&&(n.style.display="none"),e.filterContent&&e.filterContent("")}}}}),document.addEventListener("click",()=>{document.querySelectorAll(".keyboard-focus").forEach(e=>{e.classList.remove("keyboard-focus")})})}function navigateRows(e,t,n){e.forEach(e=>e.classList.remove("keyboard-focus"));let o=t+n;o<0&&(o=0),o>=e.length&&(o=e.length-1),e[o]&&(e[o].classList.add("keyboard-focus"),e[o].scrollIntoView({block:"nearest",behavior:"smooth"}))}function updatePlatformSpecificUI(){const e=navigator.platform.toUpperCase().indexOf("MAC")>=0?"âŒ˜":"Ctrl",t=document.getElementById("searchKeyboardHint");t&&(t.textContent=`${e}K`);const n=document.getElementById("modKey1"),o=document.getElementById("modKey2"),s=document.getElementById("modKey3");n&&(n.textContent=e),o&&(o.textContent=e),s&&(s.textContent=e)}function showToast(e,t="info",n=3e3,o=null){const s=document.getElementById("toast");if(s)if(s.textContent=e,s.className=`toast toast-${t} active`,o){s.style.cursor="pointer";const e=s.cloneNode(!0);s.parentNode.replaceChild(e,s),e.addEventListener("click",()=>{o(),e.classList.remove("active")}),setTimeout(()=>{e.classList.remove("active"),e.style.cursor=""},n)}else s.style.cursor="",setTimeout(()=>{s.classList.remove("active")},n)}async function gatherDiagnostics(e){const[t]=await chrome.tabs.query({active:!0,currentWindow:!0}),n=await chrome.runtime.getPlatformInfo(),o=await chrome.storage.local.get(["shortcuts","environments","notes"]);return{timestamp:(new Date).toLocaleString(),instance:e||{},browser:`Chrome ${navigator.userAgent.match(/Chrome\/([0-9.]+)/)?.[1]||"Unknown"}`,extension:chrome.runtime.getManifest().version,platform:n.os,currentURL:t?.url||"N/A",shortcuts:(o.shortcuts||[]).length,environments:(o.environments||[]).length,notes:(o.notes||[]).length}}function formatDiagnosticsReport(e){const t=e.instance,n=t.environment?ENV_LABELS[t.environment]:"N/A",o=t.environment?ENV_EMOJIS[t.environment]:"";let s="";return t.userName&&(s+=`Full Name:       ${t.userName}\n`),t.userId&&(s+=`User ID:         ${t.userId}\n`),t.personId&&(s+=`Person ID:       ${t.personId}\n`),t.personIdExternal&&(s+=`Person ID (ext): ${t.personIdExternal}\n`),(t.assignmentIdExternal||t.assignmentId)&&(s+=`Assignment UUID: ${t.assignmentIdExternal||t.assignmentId}\n`),t.proxyId&&(s+=`Proxy ID:        ${t.proxyId}\n`),s||(s="No user information available\n"),`â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nSAP PRO TOOLKIT - DIAGNOSTICS REPORT\nv${e.extension}\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nGenerated: ${e.timestamp}\n\nINSTANCE INFORMATION\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nEnvironment:     ${o} ${n}\nCompany ID:      ${t.companyId||"N/A"}\nDatacenter:      ${t.datacenter||"N/A"}\nProvider:        ${t.platform||"N/A"}\nRegion:          ${t.region||"N/A"}\nCountry:         ${t.country||"N/A"}\n\nURLS\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nCurrent:         ${e.currentURL}\nHostname:        ${t.hostname||"N/A"}\nAPI Endpoint:    ${t.apiHostname||"N/A"}\n\nUSER INFORMATION\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n${s}\nTECHNICAL DETAILS\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nBrowser:         ${e.browser}\nExtension:       SAP Pro Toolkit v${e.extension}\nPlatform:        ${e.platform}\nDetection:       ${t.detectedVia||"N/A"}\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nCopy this information when reporting issues\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`}
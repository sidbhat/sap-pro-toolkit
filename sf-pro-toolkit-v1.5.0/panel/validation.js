const VALIDATION_LIMITS={ENV_NAME_MIN:3,ENV_NAME_MAX:100,ENV_HOSTNAME_MIN:5,ENV_HOSTNAME_MAX:255,ENV_NOTES_MAX:500,SHORTCUT_NAME_MIN:3,SHORTCUT_NAME_MAX:100,SHORTCUT_URL_MIN:10,SHORTCUT_URL_MAX:2e3,SHORTCUT_NOTES_MAX:500,NOTE_TITLE_MIN:3,NOTE_TITLE_MAX:100,NOTE_CONTENT_MAX:5e3,TAG_NAME_MIN:1,TAG_NAME_MAX:30,TAG_MAX_COUNT:10};function sanitizeText(t,e,s={}){return t&&"string"==typeof t?(t=(t=(t=(t=t.replace(/<[^>]*>/g,"")).replace(/javascript:/gi,"")).replace(/on\w+\s*=/gi,"")).trim().replace(/\s+/g," "),e&&t.length>e&&(t=t.substring(0,e).trim()),s.capitalize&&t.length>0&&(t=t.charAt(0).toUpperCase()+t.slice(1)),s.lowercase&&(t=t.toLowerCase()),t):""}function sanitizeHostname(t){if(!t||"string"!=typeof t)return"";let e=(t=(t=t.replace(/^https?:\/\//,"")).trim().toLowerCase()).split("/")[0].split("?")[0].split("#")[0];e=e.replace(/\s+/g,"");const s=t.substring(e.length);return e&&!/^[a-zA-Z0-9.-]+$/.test(e)&&(e=e.replace(/[^a-zA-Z0-9.-]/g,"")),e+s}function sanitizeUrl(t){return t&&"string"==typeof t?(t=t.trim()).match(/^(javascript|data|vbscript):/i)?"":(t.startsWith("http://")||t.startsWith("https://")||t.startsWith("/")||(t="https://"+t),t):""}function sanitizeTags(t){if(!t||"string"!=typeof t)return[];const e=t.split(",").map(t=>((t=(t=(t=t.trim()).replace(/[^a-zA-Z0-9\s-_]/g,"")).replace(/\s+/g," ")).length>0&&(t=t.charAt(0).toUpperCase()+t.slice(1)),t.length>VALIDATION_LIMITS.TAG_NAME_MAX&&(t=t.substring(0,VALIDATION_LIMITS.TAG_NAME_MAX)),t)).filter(t=>t.length>=VALIDATION_LIMITS.TAG_NAME_MIN).slice(0,VALIDATION_LIMITS.TAG_MAX_COUNT),s=[],a=new Set;for(const t of e){const e=t.toLowerCase();a.has(e)||(a.add(e),s.push(t))}return s}function validateEnvironment(t){const e=[],s={};s.name=sanitizeText(t.name,VALIDATION_LIMITS.ENV_NAME_MAX,{capitalize:!0}),s.name.length<VALIDATION_LIMITS.ENV_NAME_MIN&&e.push(`Environment name must be at least ${VALIDATION_LIMITS.ENV_NAME_MIN} characters`),s.name.length>VALIDATION_LIMITS.ENV_NAME_MAX&&e.push(`Environment name must be less than ${VALIDATION_LIMITS.ENV_NAME_MAX} characters`),s.hostname=sanitizeHostname(t.hostname),s.hostname.length<VALIDATION_LIMITS.ENV_HOSTNAME_MIN&&e.push(`Hostname must be at least ${VALIDATION_LIMITS.ENV_HOSTNAME_MIN} characters`),s.hostname.length>VALIDATION_LIMITS.ENV_HOSTNAME_MAX&&e.push(`Hostname must be less than ${VALIDATION_LIMITS.ENV_HOSTNAME_MAX} characters`);const a=s.hostname.split("/")[0].split("?")[0].split("#")[0];["hr.cloud.sap","sapsf.com","sapsf.cn","sapcloud.cn","successfactors.eu","sapsf.eu","successfactors.com","s4hana.ondemand.com","s4hana.cloud.sap","hana.ondemand.com","cfapps","build.cloud.sap","ibp.cloud.sap","scmibp.ondemand.com","ibplanning"].some(t=>a.includes(t))||e.push("Must be a valid SAP hostname (SuccessFactors, S/4HANA, BTP, or IBP)");return s.type=t.type&&["production","preview","sales","sandbox"].includes(t.type)?t.type:"production",s.notes=sanitizeText(t.notes||"",VALIDATION_LIMITS.ENV_NOTES_MAX),t.id&&(s.id=t.id),{valid:0===e.length,errors:e,sanitized:s}}function validateShortcut(t){const e=[],s={};return s.name=sanitizeText(t.name,VALIDATION_LIMITS.SHORTCUT_NAME_MAX,{capitalize:!0}),s.name.length<VALIDATION_LIMITS.SHORTCUT_NAME_MIN&&e.push(`Shortcut name must be at least ${VALIDATION_LIMITS.SHORTCUT_NAME_MIN} characters`),s.name.length>VALIDATION_LIMITS.SHORTCUT_NAME_MAX&&e.push(`Shortcut name must be less than ${VALIDATION_LIMITS.SHORTCUT_NAME_MAX} characters`),s.url=sanitizeUrl(t.url),s.url.startsWith("http://")||s.url.startsWith("https://")||e.push("URL must start with http:// or https:// (external links only)"),s.url.length<VALIDATION_LIMITS.SHORTCUT_URL_MIN&&e.push(`URL must be at least ${VALIDATION_LIMITS.SHORTCUT_URL_MIN} characters`),s.url.length>VALIDATION_LIMITS.SHORTCUT_URL_MAX&&e.push(`URL must be less than ${VALIDATION_LIMITS.SHORTCUT_URL_MAX} characters`),s.notes=sanitizeText(t.notes||"",VALIDATION_LIMITS.SHORTCUT_NOTES_MAX),s.icon=t.icon||"8",s.tags=sanitizeTags(t.tags||""),t.id&&(s.id=t.id),{valid:0===e.length,errors:e,sanitized:s}}function validateNote(t){const e=[],s={};return s.title=sanitizeText(t.title,VALIDATION_LIMITS.NOTE_TITLE_MAX,{capitalize:!0}),s.title.length<VALIDATION_LIMITS.NOTE_TITLE_MIN&&e.push(`Note title must be at least ${VALIDATION_LIMITS.NOTE_TITLE_MIN} characters`),s.title.length>VALIDATION_LIMITS.NOTE_TITLE_MAX&&e.push(`Note title must be less than ${VALIDATION_LIMITS.NOTE_TITLE_MAX} characters`),s.content=sanitizeText(t.content||"",VALIDATION_LIMITS.NOTE_CONTENT_MAX),s.icon=t.icon||"0",s.tags=sanitizeTags(t.tags||""),t.id&&(s.id=t.id),t.timestamp&&(s.timestamp=t.timestamp),{valid:0===e.length,errors:e,sanitized:s}}function migrateData(t,e){return Array.isArray(t)?t.map(t=>{let s;switch(e){case"environment":s=validateEnvironment(t);break;case"shortcut":s=validateShortcut(t);break;case"note":s=validateNote(t);break;default:return t}return s.valid?s.sanitized:s.sanitized||t}):[]}function updateCharacterCounter(t,e,s){if(!t||!e)return;const a=t.value.length,n=s-a;e.textContent=`${a}/${s}`,n<50?e.classList.add("char-warning"):e.classList.remove("char-warning"),n<0?e.classList.add("char-error"):e.classList.remove("char-error")}function setupCharacterCounter(t,e,s){const a=document.getElementById(t),n=document.getElementById(e);a&&n&&(a.setAttribute("maxlength",s),a.addEventListener("input",()=>{updateCharacterCounter(a,n,s)}),updateCharacterCounter(a,n,s))}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SF Pro Toolkit</title>
  <link rel="stylesheet" href="side-panel.css">
</head>

<body>
  <!-- 
  ===== SF PRO TOOLKIT BRANDING STANDARDS =====
  
  LOGO USAGE:
  - Source: ../icons/icon-32.png (official extension icon)
  - Header: 28x28px with class="header-logo"
  - Modals: 32x32px with class="modal-icon"
  
  STANDARD MODAL HEADER PATTERN:
  <div class="modal-header">
    <div class="modal-header-title">
      <img src="../icons/icon-32.png" alt="SF Pro Toolkit" class="modal-icon">
      <h3>[Modal Title]</h3>
    </div>
    <button class="icon-btn" id="close[Modal]Modal">&times;</button>
  </div>
  
  CHECKLIST FOR NEW MODALS:
  ‚úì modal-header has modal-header-title wrapper?
  ‚úì Includes icon-32.png with class="modal-icon"?
  ‚úì Alt text is "SF Pro Toolkit"?
  ‚úì CSS uses var(--logo-size-modal)?
-->
  <div class="side-panel-container">
    <!-- Header -->
    <div class="side-panel-header">
      <div class="header-content">
        <button class="icon-btn icon-btn--transparent-light" id="helpBtn" data-i18n-title="helpBtn" title="Help">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" />
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
            <line x1="12" y1="17" x2="12.01" y2="17" />
          </svg>
        </button>
        <div class="header-title-group">
          <svg class="header-logo" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="32" height="32" rx="6" fill="url(#gradient1)" />
            <path d="M9 12h14M9 16h14M9 20h10" stroke="white" stroke-width="2" stroke-linecap="round" />
            <defs>
              <linearGradient id="gradient1" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
                <stop stop-color="#0070F2" />
                <stop offset="1" stop-color="#0054A6" />
              </linearGradient>
            </defs>
          </svg>
          <h1 class="header-title" data-i18n="headerTitle">SF Pro Toolkit</h1>
        </div>
        <div class="profile-switcher">
          <button class="profile-dropdown" id="profileDropdownBtn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
              <polyline points="22,6 12,13 2,6" />
            </svg>
            <span id="currentProfileName">Default</span>
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9" />
            </svg>
          </button>
          <div class="profile-menu" id="profileMenu">
            <!-- Populated dynamically -->
          </div>
        </div>
      </div>
    </div>

    <!-- Global Search -->
    <div class="search-bar">
      <div class="search-input-wrapper">
        <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2">
          <circle cx="11" cy="11" r="8" />
          <path d="m21 21-4.35-4.35" />
        </svg>
        <input type="text" id="globalSearch" class="search-input" placeholder="Search all items..."
          data-i18n-placeholder="globalSearchPlaceholder">
        <button class="icon-btn" id="clearSearch" style="display: none;">√ó</button>
      </div>
      <button class="btn btn-ai btn-sm" id="aiSearchBtn" title="Perform AI-powered search (Cmd+Shift+S)"
        aria-label="AI Search">
        ‚ú® AI
      </button>
    </div>

    <!-- AI Insights Bar (Hidden by default) -->
    <div class="ai-insights-bar" id="aiInsightsBar" style="display: none;">
      <div class="ai-insights-header">
        <span class="ai-insights-title">‚ú® AI INSIGHTS</span>
        <button class="icon-btn" id="closeAiInsights" title="Clear AI search"
          style="height: 24px; width: 24px;">√ó</button>
      </div>
      <div class="ai-insights-content" id="aiInsightsContent">
        <!-- Populated dynamically -->
      </div>
    </div>

    <!-- Environments Section -->
    <section class="section" data-section="environments">
      <div class="section-header">
        <button class="section-toggle-btn" data-section="environments" title="Collapse section">
          <svg class="section-toggle-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2.5">
            <polyline points="6 9 12 15 18 9" />
          </svg>
        </button>
        <div>
          <h2 class="section-title">ENVIRONMENTS <span class="section-count"></span></h2>
          <p class="section-desc">Switch between Production, Preview, Sales, and Sandbox instances</p>
        </div>
        <button class="btn-add" id="addEnvBtn" data-title="Add Environment">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <line x1="12" y1="5" x2="12" y2="19" />
            <line x1="5" y1="12" x2="19" y2="12" />
          </svg>
        </button>
      </div>

      <div class="section-content">
        <div class="table-container">
          <table class="data-table" id="environmentsTable">
            <tbody id="environmentList">
              <tr class="empty-row">
                <td colspan="4">
                  <div class="empty-state">
                    <p>No saved environments</p>
                    <button class="btn btn-secondary btn-sm" id="addEnvBtnInline">+ Add Current Instance</button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Combined Shortcuts & Notes Section -->
    <section class="section" data-section="shortcuts">
      <div class="section-header">
        <button class="section-toggle-btn" data-section="shortcuts" title="Collapse section">
          <svg class="section-toggle-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2.5">
            <polyline points="6 9 12 15 18 9" />
          </svg>
        </button>
        <div>
          <h2 class="section-title">SHORTCUTS <span class="section-count"></span></h2>
          <p class="section-desc">External links and reference information</p>
        </div>
        <button class="btn btn-accent btn-sm" id="ossNoteBtn" title="Search OSS Note"
          style="padding: 6px 10px; font-size: 12px; margin-right: 8px;">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8" />
            <path d="m21 21-4.35-4.35" />
          </svg>
          OSS Note
        </button>
        <button class="btn-add" id="addShortcutBtn" data-title="Add Shortcut" title="Add shortcut">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <line x1="12" y1="5" x2="12" y2="19" />
            <line x1="5" y1="12" x2="19" y2="12" />
          </svg>
        </button>
        <button class="btn btn-ai btn-sm" id="addShortcutWithAIBtn" data-title="Add with AI"
          title="Add shortcut with AI summary (scrapes current page)" aria-label="Add Shortcut with AI"
          style="margin-left: 8px;">
          ‚ú® AI
        </button>
      </div>

      <div class="section-content">
        <!-- OSS Note Search Form (Hidden by default) -->
        <div id="ossNoteSearchForm" class="oss-search-form" style="display: none;">
          <div class="oss-search-header">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8" />
              <path d="m21 21-4.35-4.35" />
            </svg>
            <span>Search SAP OSS Note</span>
          </div>

          <input type="text" id="ossNoteInputInline" placeholder="Enter OSS Note #" class="oss-search-input">
          <div class="oss-search-actions">
            <button class="btn btn-primary btn-sm" id="openOssNoteInlineBtn">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
                <polyline points="15 3 21 3 21 9" />
                <line x1="10" y1="14" x2="21" y2="3" />
              </svg>
              Open
            </button>
            <button class="btn btn-secondary btn-sm" id="copyOssUrlBtn">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
              </svg>
              Copy URL
            </button>
            <button class="btn btn-secondary btn-sm" id="addOssShortcutBtn">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19" />
                <line x1="5" y1="12" x2="19" y2="12" />
              </svg>
              Add Shortcut
            </button>
            <button class="icon-btn" id="closeOssSearchBtn" title="Close">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />
              </svg>
            </button>
          </div>
        </div>

        <div class="table-container">
          <table class="data-table" id="shortcutsTable">
            <tbody id="shortcutsList">
              <tr class="empty-row">
                <td colspan="4">
                  <div class="empty-state">
                    <p>No shortcuts</p>
                    <button class="btn btn-secondary btn-sm" id="addCurrentPageBtnEmpty">+ Add Current Page</button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Notes Section -->
    <section class="section" data-section="notes">
      <div class="section-header">
        <button class="section-toggle-btn" data-section="notes" title="Collapse section">
          <svg class="section-toggle-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2.5">
            <polyline points="6 9 12 15 18 9" />
          </svg>
        </button>
        <div>
          <h2 class="section-title">SCRATCH NOTES <span class="section-count"></span></h2>
          <p class="section-desc">Store temporary IDs, URLs, and reference information</p>
        </div>
        <button class="btn-add" id="addNoteBtn" data-title="Add Note" title="Add Note">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <line x1="12" y1="5" x2="12" y2="19" />
            <line x1="5" y1="12" x2="19" y2="12" />
          </svg>
        </button>
      </div>

      <!-- Notes Content -->
      <div class="section-content">
        <div class="table-container">
          <table class="data-table" id="notesTable">
            <tbody id="notesList">
              <tr class="empty-row">
                <td colspan="4">
                  <div class="empty-state">
                    <p>No notes</p>
                    <button class="btn btn-secondary btn-sm" id="addNoteBtnEmpty">+ Add Note</button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Sticky Footer -->
    <footer class="sticky-footer">
      <div class="footer-top-row">
        <button class="footer-btn" id="footerSettingsBtn" title="Settings">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3" />
            <path d="M12 1v6m0 6v6M5.6 5.6l4.2 4.2m4.2 4.2l4.2 4.2M1 12h6m6 0h6M5.6 18.4l4.2-4.2m4.2-4.2l4.2-4.2" />
          </svg>
          <span class="footer-btn-label">Settings</span>
        </button>
        <button class="footer-btn" id="footerDiagnosticsBtn" title="Diagnostics">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" />
            <line x1="12" y1="16" x2="12" y2="12" />
            <line x1="12" y1="8" x2="12.01" y2="8" />
          </svg>
          <span class="footer-btn-label">Diagnostics</span>
        </button>
        <button class="footer-btn" id="footerThemeBtn" title="Toggle Theme" data-theme-active="false">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
          </svg>
          <span class="footer-btn-label">Theme</span>
        </button>
      </div>

    </footer>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>
  </div>

  <!-- Add Environment Modal -->
  <div class="modal" id="addEnvModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-header-title">
          <svg class="modal-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="32" height="32" rx="6" fill="url(#gradientModal1)" />
            <path d="M9 12h14M9 16h14M9 20h10" stroke="white" stroke-width="2" stroke-linecap="round" />
            <defs>
              <linearGradient id="gradientModal1" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
                <stop stop-color="#0070F2" />
                <stop offset="1" stop-color="#0054A6" />
              </linearGradient>
            </defs>
          </svg>
          <h3 data-i18n="addEnvironmentTitle">Add Environment</h3>
        </div>
        <button class="icon-btn" id="closeAddEnvModal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="addEnvForm">
          <div class="form-group">
            <label for="envName">
              <span data-i18n="environmentName">Environment Name</span> <span class="required-asterisk">*</span>
              <span class="char-counter" id="envNameCounter">0/100</span>
            </label>
            <input type="text" id="envName" data-i18n-placeholder="environmentNamePlaceholder"
              placeholder="e.g., Production DC68" required>
          </div>
          <div class="form-group">
            <label for="envType">
              <span data-i18n="environmentType">Environment Type</span> <span class="required-asterisk">*</span>
            </label>
            <select id="envType" required>
              <option value="production">üî¥ Production</option>
              <option value="preview">üü¢ Preview</option>
              <option value="sales">üü† Sales/Demo</option>
              <option value="sandbox">üü£ Sandbox</option>
            </select>
          </div>
          <div class="form-group">
            <label for="envHostname">
              <span data-i18n="hostname">Hostname</span> <span class="required-asterisk">*</span>
              <span class="char-counter" id="envHostnameCounter">0/255</span>
            </label>
            <input type="text" id="envHostname" data-i18n-placeholder="hostnamePlaceholder"
              placeholder="hcm-us20.hr.cloud.sap" required>
            <small style="color: var(--text-secondary); font-size: 11px; display: block; margin-top: 4px;">
              Enter SAP hostname without https:// (e.g., hcm-us20.hr.cloud.sap)
            </small>
          </div>
          <div class="form-group">
            <label for="envNotes">
              Notes (optional)
              <span class="char-counter" id="envNotesCounter">0/500</span>
            </label>
            <textarea id="envNotes" rows="2"
              placeholder="e.g., Test users, credentials, special configuration..."></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelAddEnvBtn" data-i18n="cancel">Cancel</button>
        <button class="btn btn-primary" id="saveEnvBtn" data-i18n="saveEnvironment">Save</button>
      </div>
    </div>
  </div>

  <!-- Add Shortcut Modal -->
  <div class="modal" id="addShortcutModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-header-title">
          <svg class="modal-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="32" height="32" rx="6" fill="url(#gradientModal2)" />
            <path d="M9 12h14M9 16h14M9 20h10" stroke="white" stroke-width="2" stroke-linecap="round" />
            <defs>
              <linearGradient id="gradientModal2" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
                <stop stop-color="#0070F2" />
                <stop offset="1" stop-color="#0054A6" />
              </linearGradient>
            </defs>
          </svg>
          <h3 data-i18n="addShortcutTitle">Add Shortcut</h3>
        </div>
        <button class="icon-btn" id="closeAddShortcutModal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="addShortcutForm">
          <div class="form-group">
            <label for="shortcutName">
              <span data-i18n="shortcutName">Name</span> <span class="required-asterisk">*</span>
              <span class="char-counter" id="shortcutNameCounter">0/100</span>
            </label>
            <input type="text" id="shortcutName" placeholder="e.g., Admin Center" required>
          </div>
          <div class="form-group">
            <label for="shortcutPath">
              <span data-i18n="shortcutUrl">URL</span> <span class="required-asterisk">*</span>
              <span class="char-counter" id="shortcutPathCounter">0/2000</span>
            </label>
            <input type="text" id="shortcutPath" placeholder="e.g., https://roadmaps.sap.com/..." required>
            <small style="color: var(--text-secondary); font-size: 11px; display: block; margin-top: 4px;">
              Enter full URL starting with https:// (external links only)
            </small>
          </div>
          <div class="form-group">
            <label for="shortcutNotes">
              Notes
              <span class="char-counter" id="shortcutNotesCounter">0/5000</span>
            </label>
            <textarea id="shortcutNotes" rows="8" maxlength="5000"
              placeholder="Optional description or AI-generated summary..."></textarea>
          </div>
          <div class="form-group">
            <label for="shortcutTags">
              Tags (comma-separated)
              <span class="char-counter" id="shortcutTagsCounter">0/300</span>
            </label>
            <input type="text" id="shortcutTags" placeholder="e.g., SuccessFactors, Admin, Configuration">
            <small style="font-size: 10px; color: var(--text-tertiary); display: block; margin-top: 4px;">
              Use tags to organize and search shortcuts
            </small>
          </div>
          <div class="form-group">
            <label for="shortcutIcon">Icon</label>
            <div id="shortcutIconPicker" class="icon-picker-container"></div>
            <input type="hidden" id="shortcutIcon" value="link">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelAddShortcutBtn">Cancel</button>
        <button class="btn btn-primary" id="saveShortcutBtn">Save</button>
      </div>
    </div>
  </div>

  <!-- Add Note Modal -->
  <div class="modal" id="addNoteModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-header-title">
          <svg class="modal-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="32" height="32" rx="6" fill="url(#gradientModal3)" />
            <path d="M9 12h14M9 16h14M9 20h10" stroke="white" stroke-width="2" stroke-linecap="round" />
            <defs>
              <linearGradient id="gradientModal3" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
                <stop stop-color="#0070F2" />
                <stop offset="1" stop-color="#0054A6" />
              </linearGradient>
            </defs>
          </svg>
          <h3>Scratch Note</h3>
        </div>
        <button class="icon-btn" id="closeAddNoteModal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="addNoteForm">
          <div class="form-group">
            <label for="noteTitle">
              <span>Title</span> <span class="required-asterisk">*</span>
              <span class="char-counter" id="noteTitleCounter">0/100</span>
            </label>
            <input type="text" id="noteTitle" placeholder="e.g., Test User IDs" required>
          </div>

          <div class="form-group">
            <label>Note Type <span class="required-asterisk">*</span></label>
            <div class="note-type-selector">
              <label class="note-type-option">
                <input type="radio" name="noteType" value="note" checked>
                <span class="note-type-icon">üìù</span>
                <span class="note-type-label">Note</span>
              </label>
              <label class="note-type-option">
                <input type="radio" name="noteType" value="ai-prompt">
                <span class="note-type-icon">‚ú®</span>
                <span class="note-type-label">AI Prompt</span>
              </label>
            </div>
          </div>

          <div class="form-group">
            <label for="noteContent">
              Content
              <span class="char-counter" id="noteContentCounter">0</span>
            </label>
            <textarea id="noteContent" rows="6" placeholder="Paste IDs, URLs, configs..."></textarea>
            <small style="font-size: 10px; color: var(--text-tertiary); display: block; margin-top: 4px;">
              No character limit. Soft warning at 5000+ characters.
            </small>
          </div>

          <div class="form-group">
            <label for="noteIcon">Icon</label>
            <div id="noteIconPicker" class="icon-picker-container"></div>
            <input type="hidden" id="noteIcon" value="note">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <div class="modal-footer-left">
          <button class="icon-btn" id="downloadNoteBtn" title="Download note as text file" aria-label="Download"
            style="display: none;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
              <polyline points="7 10 12 15 17 10" />
              <line x1="12" y1="15" x2="12" y2="3" />
            </svg>
          </button>
          <button class="icon-btn" id="copyNoteContentBtn" title="Copy content to clipboard" aria-label="Copy">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
            </svg>
          </button>
        </div>
        <div class="modal-footer-right">
          <button class="btn btn-secondary" id="cancelAddNoteBtn">Cancel</button>
          <button class="btn btn-ai" id="enhanceWithAIBtn" style="display: none;" title="Enhance note with AI"
            aria-label="Enhance with AI">
            ‚ú® AI
          </button>
          <button class="btn btn-primary" id="saveNoteBtn">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- AI Test Results Modal -->
  <div class="modal modal-large" id="aiTestResultsModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-header-title">
          <svg class="modal-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="32" height="32" rx="6" fill="url(#gradientModalAI)" />
            <path d="M9 12h14M9 16h14M9 20h10" stroke="white" stroke-width="2" stroke-linecap="round" />
            <defs>
              <linearGradient id="gradientModalAI" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
                <stop stop-color="#0070F2" />
                <stop offset="1" stop-color="#0054A6" />
              </linearGradient>
            </defs>
          </svg>
          <h3 id="aiTestResultsTitle">AI Response</h3>
        </div>
        <button class="icon-btn" id="closeAiTestResultsModal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="aiTestResultsContent" class="ai-test-results-content">
          <!-- Populated dynamically -->
        </div>
      </div>
      <div class="modal-footer">
        <div class="modal-footer-left">
          <button class="btn btn-secondary" id="copyAiResponseBtn" title="Copy response to clipboard"
            aria-label="Copy Response">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
            </svg>
            Copy
          </button>
          <button class="btn btn-secondary" id="openEnterpriseCalcBtn" title="Open enterprise calculator"
            aria-label="Open Calculator">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
              <line x1="3" y1="9" x2="21" y2="9" />
              <line x1="9" y1="21" x2="9" y2="9" />
            </svg>
            Calculator
          </button>
        </div>
        <div class="modal-footer-right">
          <button class="btn btn-primary" id="saveAiResponseBtn" title="Save AI response as note"
            aria-label="Save as Note">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
              <polyline points="17 21 17 13 7 13 7 21" />
              <polyline points="7 3 7 8 15 8" />
            </svg>
            Save as Note
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Enterprise Cost Calculator Modal (NEW - Phase 5) -->
  <div class="modal modal-large" id="enterpriseCalculatorModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-header-title">
          <svg class="modal-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="32" height="32" rx="6" fill="url(#gradientModalEnterprise)" />
            <path d="M9 12h14M9 16h14M9 20h10" stroke="white" stroke-width="2" stroke-linecap="round" />
            <defs>
              <linearGradient id="gradientModalEnterprise" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
                <stop stop-color="#0070F2" />
                <stop offset="1" stop-color="#0054A6" />
              </linearGradient>
            </defs>
          </svg>
          <h3>Enterprise Cost Calculator</h3>
        </div>
        <button class="icon-btn" id="closeEnterpriseCalculatorModal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="enterpriseCalculatorContent">
          <!-- Populated dynamically by openEnterpriseCalculator() -->
        </div>
      </div>
      <div class="modal-footer">
        <div class="modal-footer-left">
          <button class="btn btn-secondary" id="exportEnterpriseReportBtn" style="display: none;"
            title="Export report as note" aria-label="Export Report">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
              <polyline points="17 8 12 3 7 8" />
              <line x1="12" y1="3" x2="12" y2="15" />
            </svg>
            Export Report
          </button>
        </div>
        <div class="modal-footer-right">
          <button class="btn btn-secondary" id="closeEnterpriseCalculatorBtn">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal modal-large" id="settingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-header-title">
          <svg class="modal-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="32" height="32" rx="6" fill="url(#gradientModal4)" />
            <path d="M9 12h14M9 16h14M9 20h10" stroke="white" stroke-width="2" stroke-linecap="round" />
            <defs>
              <linearGradient id="gradientModal4" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
                <stop stop-color="#0070F2" />
                <stop offset="1" stop-color="#0054A6" />
              </linearGradient>
            </defs>
          </svg>
          <h3>Settings</h3>
        </div>
        <button class="icon-btn" id="closeSettingsModal">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Tab Navigation -->
        <div class="settings-tabs">
          <button class="settings-tab active" data-tab="quick-actions">‚ö° Quick Actions</button>
          <button class="settings-tab" data-tab="api-keys">üîë API Keys</button>
          <button class="settings-tab" data-tab="backup">üì¶ Import/Export</button>
        </div>

        <!-- Tab 1: Quick Actions (Editable Text Fields) -->
        <div class="settings-tab-content active" id="quick-actions-tab">
          <p style="margin: 0 0 16px 0; font-size: 12px; color: var(--text-secondary);">
            Edit Quick Action names and paths, then click "Save All Changes" below.
          </p>
          <div id="qaEditableList">
            <!-- Populated dynamically with editable text fields -->
          </div>
          <div class="qa-save-footer" style="margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--border);">
            <button class="btn btn-primary btn-block" id="saveAllQaBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                <polyline points="17 21 17 13 7 13 7 21" />
                <polyline points="7 3 7 8 15 8" />
              </svg>
              Save All Changes
            </button>
          </div>
        </div>

        <!-- Tab 2: API Keys (NEW - Phase 6) -->
        <div class="settings-tab-content" id="api-keys-tab">
          <div class="form-group-toggle">
            <label for="enableAiFeatures" class="toggle-switch-label">‚ú® Enable AI Features</label>
            <label class="switch">
              <input type="checkbox" id="enableAiFeatures" checked>
              <span class="slider round"></span>
            </label>
          </div>
          <small
            style="font-size: 10px; color: var(--text-tertiary); display: block; margin-top: 4px; margin-bottom: 20px;">
            Globally enable or disable AI-powered features. When disabled, all AI-related buttons and options will be
            hidden.
          </small>

          <div id="apiKeysContainer">
            <p style="margin: 0 0 16px 0; font-size: 12px; color: var(--text-secondary);">
              Configure your API keys for live AI testing. Keys are encrypted and stored locally.
            </p>

            <!-- OpenAI API Key -->
            <div class="api-key-section">
              <h4
                style="margin: 0 0 8px 0; font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10" />
                  <path d="M12 6v6l4 2" />
                </svg>
                OpenAI API Key
              </h4>
              <div class="form-group" style="margin-bottom: 8px;">
                <input type="password" id="apiKeyopenaiInput" placeholder="sk-..." class="api-key-input">
                <button class="btn btn-secondary btn-sm" id="testOpenAIBtn" style="margin-top: 8px;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12" />
                  </svg>
                  Test Connection
                </button>
                <button class="btn btn-danger btn-sm" id="clearOpenAIBtn" style="margin-top: 8px; margin-left: 8px;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18" />
                    <line x1="6" y1="6" x2="18" y2="18" />
                  </svg>
                  Clear
                </button>
              </div>
              <small style="font-size: 10px; color: var(--text-tertiary); display: block; margin-bottom: 16px;">
                Get your API key from <a href="https://platform.openai.com/api-keys" target="_blank"
                  style="color: var(--accent-color);">platform.openai.com/api-keys</a>
              </small>
            </div>

            <!-- Anthropic API Key -->
            <div class="api-key-section">
              <h4
                style="margin: 0 0 8px 0; font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path
                    d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
                </svg>
                Anthropic API Key
              </h4>
              <div class="form-group" style="margin-bottom: 8px;">
                <input type="password" id="apiKeyanthropicInput" placeholder="sk-ant-..." class="api-key-input">
                <button class="btn btn-secondary btn-sm" id="testAnthropicBtn" style="margin-top: 8px;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12" />
                  </svg>
                  Test Connection
                </button>
                <button class="btn btn-danger btn-sm" id="clearAnthropicBtn" style="margin-top: 8px; margin-left: 8px;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18" />
                    <line x1="6" y1="6" x2="18" y2="18" />
                  </svg>
                  Clear
                </button>
              </div>
              <small style="font-size: 10px; color: var(--text-tertiary); display: block; margin-bottom: 16px;">
                Get your API key from <a href="https://console.anthropic.com/settings/keys" target="_blank"
                  style="color: var(--accent-color);">console.anthropic.com/settings/keys</a>
              </small>
            </div>

            <!-- Max Tokens Configuration (NEW) -->
            <div class="api-key-section">
              <h4
                style="margin: 0 0 8px 0; font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10" />
                  <path d="M12 6v6l4 2" />
                </svg>
                Response Length
              </h4>
              <div class="form-group" style="margin-bottom: 8px;">
                <label
                  style="font-size: 11px; font-weight: 600; color: var(--text-secondary); margin-bottom: 4px; display: block;">
                  Maximum Tokens per Response
                </label>
                <input type="number" id="maxTokensDefault" min="100" max="128000" step="100" value="4096"
                  placeholder="4096"
                  style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-primary); color: var(--text-primary); font-size: 12px;">
                <small style="font-size: 10px; color: var(--text-tertiary); display: block; margin-top: 4px;">
                  Controls response length for all AI models (100-128000 tokens). Default: 4096. Higher values = longer
                  responses but higher costs. Most models support up to 4096 tokens.
                </small>
              </div>
              <button class="btn btn-secondary btn-sm" id="saveMaxTokensBtn" style="margin-top: 8px;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                  <polyline points="17 21 17 13 7 13 7 21" />
                  <polyline points="7 3 7 8 15 8" />
                </svg>
                Save Setting
              </button>
            </div>

            <!-- AI Core Client Id -->
            <div class="form-group" style="margin-bottom: 12px;">
              <label
                style="font-size: 11px; font-weight: 600; color: var(--text-secondary); margin-bottom: 4px; display: block;">AI
                Core Client Id</label>
              <input type="password" id="sapAiCoreClientId" placeholder="Enter client ID" value="" class="api-key-input"
                style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-primary); color: var(--text-primary); font-size: 12px;">
              <small style="font-size: 10px; color: var(--text-tertiary); display: block; margin-top: 4px;">
                Enter your SAP AI Core client ID from your service key.
              </small>
            </div>

            <!-- AI Core Client Secret -->
            <div class="form-group" style="margin-bottom: 12px;">
              <label
                style="font-size: 11px; font-weight: 600; color: var(--text-secondary); margin-bottom: 4px; display: block;">AI
                Core Client Secret</label>
              <input type="password" id="sapAiCoreClientSecret" placeholder="Enter client secret" value=""
                class="api-key-input"
                style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-primary); color: var(--text-primary); font-size: 12px;">
              <small style="font-size: 10px; color: var(--text-tertiary); display: block; margin-top: 4px;">
                Enter your SAP AI Core client secret from your service key.
              </small>
            </div>

            <!-- AI Core Base URL -->
            <div class="form-group" style="margin-bottom: 12px;">
              <label
                style="font-size: 11px; font-weight: 600; color: var(--text-secondary); margin-bottom: 4px; display: block;">AI
                Core Base URL</label>
              <input type="text" id="sapAiCoreBaseUrl" placeholder="Enter AI Core API base URL" value=""
                class="api-key-input"
                style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-primary); color: var(--text-primary); font-size: 12px;">
            </div>

            <!-- AI Core Auth URL -->
            <div class="form-group" style="margin-bottom: 12px;">
              <label
                style="font-size: 11px; font-weight: 600; color: var(--text-secondary); margin-bottom: 4px; display: block;">AI
                Core Auth URL</label>
              <input type="text" id="sapAiCoreAuthUrl" placeholder="Enter OAuth token endpoint URL" value=""
                class="api-key-input"
                style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-primary); color: var(--text-primary); font-size: 12px;">
            </div>

            <!-- AI Core Resource Group -->
            <div class="form-group" style="margin-bottom: 16px;">
              <label
                style="font-size: 11px; font-weight: 600; color: var(--text-secondary); margin-bottom: 4px; display: block;">AI
                Core Resource Group</label>
              <input type="text" id="sapAiCoreResourceGroup" placeholder="default" value="default" class="api-key-input"
                style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-primary); color: var(--text-primary); font-size: 12px;">
            </div>

            <!-- Storage Notice -->
            <small style="font-size: 10px; color: var(--text-tertiary); display: block; margin-bottom: 12px;">
              These credentials are stored locally and only used to make API requests from this extension. <a
                href="https://help.sap.com/docs/sap-ai-core/sap-ai-core-service-guide/create-deployment-for-generative-ai-model-in-sap-ai-core"
                target="_blank" style="color: var(--accent-color);">SAP AI Core Setup Guide</a>
            </small>

            <!-- Model Dropdown (populated after connection) -->
            <div class="form-group" style="margin-bottom: 12px;">
              <label
                style="font-size: 11px; font-weight: 600; color: var(--text-secondary); margin-bottom: 4px; display: block;">Deployed
                Models</label>
              <select id="sapAiCoreModel"
                style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-secondary); color: var(--text-primary); font-size: 12px;"
                disabled>
                <option value="">Connect to load deployed models...</option>
              </select>
              <small style="font-size: 10px; color: var(--text-tertiary); display: block; margin-top: 4px;">
                Only shows RUNNING deployments from your resource group. Click "Connect" or "Refresh" to update.
              </small>
            </div>

            <!-- Action Buttons (3 buttons same row) -->
            <div style="display: flex; gap: 8px; margin-top: 12px;">
              <button class="btn btn-secondary btn-sm" id="testSAPAICoreBtn" style="flex: 1;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="20 6 9 17 4 12" />
                </svg>
                Connect & Load Models
              </button>
              <button class="btn btn-accent btn-sm" id="saveSAPAICoreBtn" title="Save configuration" style="flex: 1;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                  <polyline points="17 21 17 13 7 13 7 21" />
                  <polyline points="7 3 7 8 15 8" />
                </svg>
                Save
              </button>
              <button class="btn btn-danger btn-sm" id="clearSAPAICoreBtn" title="Clear all configuration"
                style="flex: 1;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18" />
                  <line x1="6" y1="6" x2="18" y2="18" />
                </svg>
                Clear
              </button>
            </div>

            <!-- Primary Model Indicator (Hidden by default, shown when model is saved) -->
            <div id="sapAiCorePrimaryIndicator"
              style="display: none; margin-top: 12px; padding: 10px 12px; background: rgba(16, 185, 129, 0.1); border-left: 3px solid #10B981; border-radius: 4px;">
              <div
                style="font-size: 11px; color: #10B981; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="#10B981" stroke="#10B981" stroke-width="2">
                  <polygon
                    points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
                </svg>
                <span>Primary Model: <span id="primaryModelName">-</span></span>
              </div>
              <div style="font-size: 10px; color: var(--text-secondary); margin-top: 4px;">
                This model will be used by default for all AI features (Test, AI Prompts)
              </div>
            </div>

            <div
              style="margin-top: 24px; padding: 12px; background: rgba(var(--accent-rgb), 0.1); border-radius: 6px; border-left: 3px solid var(--accent-color);">
              <p style="margin: 0; font-size: 11px; color: var(--text-secondary);">
                üîí <strong>Security</strong>: API keys are encrypted using AES-256-GCM and stored locally in your
                browser.
                Keys are never sent to external servers except the API providers you configure.
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab 3: Import/Export -->
      <div class="settings-tab-content" id="backup-tab">
        <p style="margin: 0 0 16px 0; font-size: 12px; color: var(--text-secondary);">
          Backup and restore your configuration including environments, shortcuts, notes, and Quick Actions.
        </p>

        <!-- Export Section -->
        <div class="api-key-section">
          <h4
            style="margin: 0 0 8px 0; font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
              <polyline points="17 8 12 3 7 8" />
              <line x1="12" y1="3" x2="12" y2="15" />
            </svg>
            Export Configuration
          </h4>
          <div class="form-group" style="margin-bottom: 0;">
            <small style="font-size: 10px; color: var(--text-tertiary); display: block; margin-bottom: 12px;">
              Export all profiles as a full backup
            </small>
            <button class="btn btn-accent btn-block" id="exportAllBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                <polyline points="17 8 12 3 7 8" />
                <line x1="12" y1="3" x2="12" y2="15" />
              </svg>
              Export All Profiles (Full Backup)
            </button>
          </div>
        </div>

        <!-- Import Section -->
        <div class="api-key-section">
          <h4
            style="margin: 0 0 8px 0; font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
              <polyline points="7 10 12 15 17 10" />
              <line x1="12" y1="15" x2="12" y2="3" />
            </svg>
            Import Configuration
          </h4>
          <div class="form-group" style="margin-bottom: 0;">
            <small style="font-size: 10px; color: var(--text-tertiary); display: block; margin-bottom: 12px;">
              Import previously exported JSON file to restore your configuration
            </small>
            <button class="btn btn-secondary btn-block" id="importJsonBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                <polyline points="7 10 12 15 17 10" />
                <line x1="12" y1="15" x2="12" y2="3" />
              </svg>
              Import JSON File
            </button>
            <input type="file" id="importFileInput" accept=".json" style="display: none;">
          </div>
        </div>

        <!-- Reset Profile Section (NEW) -->
        <div class="api-key-section">
          <h4
            style="margin: 0 0 8px 0; font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23 4 23 10 17 10" />
              <polyline points="1 20 1 14 7 14" />
              <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
            </svg>
            Reset Profile Data
          </h4>
          <div class="form-group" style="margin-bottom: 0;">
            <small style="font-size: 10px; color: var(--text-tertiary); display: block; margin-bottom: 12px;">
              Clear current profile data and reload from default JSON file
            </small>
            <button class="btn btn-danger btn-block" id="resetProfileBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="23 4 23 10 17 10" />
                <polyline points="1 20 1 14 7 14" />
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
              </svg>
              Reset Current Profile
            </button>
          </div>
        </div>

        <!-- Security Notice -->
        <div
          style="margin-top: 24px; padding: 12px; background: rgba(var(--accent-rgb), 0.1); border-radius: 6px; border-left: 3px solid var(--accent-color);">
          <p style="margin: 0; font-size: 11px; color: var(--text-secondary);">
            üîí <strong>Security</strong>: Exported files contain your configuration in plain text. Store them securely
            and do not share files containing sensitive information.
          </p>
        </div>
      </div>
    </div>
  </div>
  </div>

  <!-- New Profile Modal -->
  <div class="modal" id="newProfileModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-header-title">
          <svg class="modal-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="32" height="32" rx="6" fill="url(#gradientModalProfile)" />
            <path d="M9 12h14M9 16h14M9 20h10" stroke="white" stroke-width="2" stroke-linecap="round" />
            <defs>
              <linearGradient id="gradientModalProfile" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
                <stop stop-color="#0070F2" />
                <stop offset="1" stop-color="#0054A6" />
              </linearGradient>
            </defs>
          </svg>
          <h3>‚ú® New Profile</h3>
        </div>
        <button class="icon-btn" id="closeNewProfileModal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="newProfileForm">
          <div class="form-group">
            <label for="newProfileName">
              Profile Name <span class="required-asterisk">*</span>
              <span class="char-counter" id="newProfileNameCounter">0/100</span>
            </label>
            <input type="text" id="newProfileName" placeholder="e.g., My Custom Profile" required maxlength="100">
          </div>
          <div class="form-group">
            <label for="newProfileDesc">
              Description
              <span class="char-counter" id="newProfileDescCounter">0/200</span>
            </label>
            <textarea id="newProfileDesc" rows="2" placeholder="Optional description..." maxlength="200"></textarea>
          </div>
          <div class="form-group">
            <label for="newProfileIcon">Icon</label>
            <div id="profileIconPicker" class="icon-picker-container"></div>
            <input type="hidden" id="newProfileIcon" value="folder">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelNewProfileBtn">Cancel</button>
        <button class="btn btn-primary" id="saveNewProfileBtn">Create Profile</button>
      </div>
    </div>
  </div>

  <!-- Help Modal -->
  <div class="modal" id="helpModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-header-title">
          <svg class="modal-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="32" height="32" rx="6" fill="url(#gradientModal5)" />
            <path d="M9 12h14M9 16h14M9 20h10" stroke="white" stroke-width="2" stroke-linecap="round" />
            <defs>
              <linearGradient id="gradientModal5" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
                <stop stop-color="#0070F2" />
                <stop offset="1" stop-color="#0054A6" />
              </linearGradient>
            </defs>
          </svg>
          <h3>About SF Pro Toolkit</h3>
        </div>
        <button class="icon-btn" id="closeHelpModal">&times;</button>
      </div>
      <div class="modal-body">
        <p style="font-size: 12px; line-height: 1.6; color: var(--text-secondary); margin-bottom: 20px;">
          SAP Pro Toolkit helps SAP professionals work more efficiently by providing quick access to environments,
          shortcuts, and diagnostic tools.
        </p>

        <h4 style="font-size: 13px; font-weight: 600; margin-bottom: 10px; color: var(--text-primary);">Key Features
        </h4>
        <ul style="font-size: 12px; line-height: 1.8; color: var(--text-secondary); margin: 0; padding-left: 20px;">
          <li><strong>Side Panel</strong>: Always accessible on the right side while you work</li>
          <li><strong>Environment Switching</strong>: Quickly switch between Production, Preview, Sales instances</li>
          <li><strong>Pin Environments</strong>: ‚≠ê Star icon to pin favorite environments to the top</li>
          <li><strong>Usage Tracking</strong>: See when you last accessed each environment and how often</li>
          <li><strong>Environment Notes</strong>: Add custom notes to environments (test users, configs, etc.)</li>
          <li><strong>Profile System</strong>: Organize configurations by profile (Global, SuccessFactors, S/4HANA, BTP,
            etc.)</li>
          <li><strong>New Content Notifications</strong>: Get notified when profile content is updated (üìã toast
            notification)</li>
          <li><strong>Smart URLs</strong>: Supports absolute external URLs for shortcuts</li>
          <li><strong>Scratch Notes</strong>: Store temporary IDs, URLs, and reference information with formatting tools
          </li>
          <li><strong>JSON Import/Export</strong>: Backup and share your configuration</li>
          <li><strong>System Diagnostics</strong>: Generate detailed reports for troubleshooting</li>
          <li><strong>Multi-language Support</strong>: Available in 10+ languages</li>
        </ul>

        <h4 style="font-size: 13px; font-weight: 600; margin: 20px 0 10px; color: var(--text-primary);">‚å®Ô∏è Keyboard
          Shortcuts</h4>
        <div class="keyboard-shortcuts-grid">
          <div class="shortcut-item">
            <kbd id="modKey1">‚åò</kbd><kbd>K</kbd>
            <span class="shortcut-desc">Focus search bar</span>
          </div>
          <div class="shortcut-item">
            <kbd id="modKey2">‚åò</kbd><kbd>J</kbd>
            <span class="shortcut-desc">Add shortcut from current page</span>
          </div>
          <div class="shortcut-item">
            <kbd id="modKey3">‚åò</kbd><kbd>E</kbd>
            <span class="shortcut-desc">Add current environment</span>
          </div>
          <div class="shortcut-item">
            <kbd id="modKey4">‚åò</kbd><kbd>Shift</kbd><kbd>1</kbd>
            <span class="shortcut-desc">Quick switch to 1st environment</span>
          </div>
          <div class="shortcut-item">
            <kbd id="modKey5">‚åò</kbd><kbd>Shift</kbd><kbd>2</kbd>
            <span class="shortcut-desc">Quick switch to 2nd environment</span>
          </div>
          <div class="shortcut-item">
            <kbd id="modKey6">‚åò</kbd><kbd>M</kbd>
            <span class="shortcut-desc">Add new note</span>
          </div>
          <div class="shortcut-item">
            <kbd>‚Üë</kbd><kbd>‚Üì</kbd>
            <span class="shortcut-desc">Navigate items</span>
          </div>
          <div class="shortcut-item">
            <kbd>Tab</kbd>
            <span class="shortcut-desc">Navigate buttons</span>
          </div>
          <div class="shortcut-item">
            <kbd>Enter</kbd>
            <span class="shortcut-desc">Open selected item</span>
          </div>
          <div class="shortcut-item">
            <kbd>Esc</kbd>
            <span class="shortcut-desc">Close modal/clear search</span>
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="closeHelpBtn">Got it!</button>
      </div>
    </div>
  </div>

  <!-- Diagnostics Modal -->
  <div id="diagnosticsModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-header-title">
          <svg class="modal-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="32" height="32" rx="6" fill="url(#gradientModalDiag)" />
            <path d="M9 12h14M9 16h14M9 20h10" stroke="white" stroke-width="2" stroke-linecap="round" />
            <defs>
              <linearGradient id="gradientModalDiag" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
                <stop stop-color="#0070F2" />
                <stop offset="1" stop-color="#0054A6" />
              </linearGradient>
            </defs>
          </svg>
          <h3>Page Diagnostics</h3>
        </div>
        <button class="icon-btn" id="closeDiagnosticsModal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="diagnosticsContent" class="diagnostics-content">
          <!-- Content populated dynamically by JavaScript -->
        </div>
      </div>
      <div class="modal-footer">
        <div class="modal-footer-left">
          <button class="btn btn-secondary" id="saveDiagnosticsBtn" style="display: none;"
            title="Save diagnostics as note">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
              <polyline points="17 21 17 13 7 13 7 21" />
              <polyline points="7 3 7 8 15 8" />
            </svg>
            Save
          </button>
          <button class="btn btn-secondary" id="downloadDiagnosticsBtn" style="display: none;"
            title="Download diagnostics report">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
              <polyline points="7 10 12 15 17 10" />
              <line x1="12" y1="15" x2="12" y2="3" />
            </svg>
            Download
          </button>
        </div>
        <div class="modal-footer-right">
          <button class="btn btn-ai" id="regenerateDiagnosticsWithAIBtn" title="Enhance diagnostics with AI analysis"
            aria-label="AI Diagnostics">
            ‚ú® AI
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Modal Overlay -->
  <div class="loading-modal" id="loadingModal">
    <div class="loading-modal-content">
      <div class="spinner-large"></div>
      <p class="loading-message" id="loadingMessage">Loading...</p>
    </div>
  </div>

  <!-- Markdown rendering libraries (loaded locally to comply with CSP) -->
  <script src="vendor/marked.min.js"></script>
  <script src="vendor/purify.min.js"></script>

  <!-- Core utilities (must be loaded before side-panel.js) -->
  <script src="crypto-utils.js"></script>
  <script src="sap-icon-library.js"></script>
  <script src="icon-picker.js"></script>
  <script src="svg-renderer.js"></script>
  <script src="validation.js"></script>
  <script src="toolkit-core.js"></script>

  <!-- Modular scripts (must be loaded before main.js and side-panel.js) -->
  <script src="state.js"></script>
  <script src="ui-render.js"></script>
  <script src="actions.js"></script>
  <script src="prompt-loader.js"></script>
  <script src="ai-features.js"></script>

  <!-- Main initialization (depends on all modules above) -->
  <script src="main.js"></script>

  <!-- Main panel script (depends on all modules above) -->
  <script src="side-panel.js"></script>
</body>

</html>